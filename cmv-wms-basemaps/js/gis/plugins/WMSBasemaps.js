/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/_base/lang","dijit/DropDownMenu","dijit/MenuItem","dojo/_base/array","dojox/lang/functional","dojo/text!./WMSBasemaps/templates/WMSBasemaps.html","esri/dijit/BasemapGallery","dojo/i18n!./WMSBasemaps/nls/resource","dijit/form/DropDownButton","xstyle/css!./WMSBasemaps/css/WMSBasemaps.css"],function(a,s,e,t,i,n,m,p,o,r,h,l){return a([s,e,t],{templateString:r,widgetsInTemplate:!0,i18n:l,mode:"",title:l.title,mapStartBasemap:"",basemapsToShow:[],validBasemaps:[],postCreate:function(){this.inherited(arguments),this.currentBasemap=this.mapStartBasemap||null,"custom"===this.mode&&(this.gallery=new h({map:this.map,showArcGISBasemaps:!1,basemaps:o.map(this.basemaps,function(a){return a.basemap})}),this.gallery.startup()),this.menu=new n({style:"display: none;"}),p.forEach(this.basemapsToShow,function(a){if(this.basemaps.hasOwnProperty(a)){var s=new m({id:a,label:this.basemaps[a].title,iconClass:a===this.mapStartBasemap?"selectedIcon":"emptyIcon",onClick:i.hitch(this,function(){var s=this.basemaps[this.currentBasemap],e=this.basemaps[a],t=this.map.extent,n=this.map;if(a!==this.currentBasemap){if(s.basemap&&s.basemap.layerInfos){var m=n.getLayer(s.basemap.id);n.removeLayer(m)}if(e.basemap&&e.basemap.layerInfos){e.basemap.initialExtent=t,e.basemap.spatialReferences=[t.spatialReference.latestWkid],n.addLayer(e.basemap,1);var o=n.getLayer(a);o.on("update-start",i.hitch(this,function(){this.dropDownButton.set("iconClass","fa fa-refresh fa-spin")})),o.on("update-end",i.hitch(this,function(){this.dropDownButton.set("iconClass","basemapsIcon")}))}else e.basemap||("agol"===this.mode?n.setBasemap(a):"custom"===this.mode&&this.gallery.select(a));this.currentBasemap=a;var r=this.menu.getChildren();p.forEach(r,function(s){s.id===a?s.set("iconClass","selectedIcon"):s.set("iconClass","emptyIcon")})}})});this.menu.addChild(s)}},this),this.dropDownButton.set("dropDown",this.menu)},startup:function(){this.inherited(arguments),"custom"===this.mode?this.map.getBasemap()!==this.mapStartBasemap&&this.gallery.select(this.mapStartBasemap):this.mapStartBasemap&&this.map.getBasemap()!==this.mapStartBasemap&&this.map.setBasemap(this.mapStartBasemap)}})});
//# sourceMappingURL=WMSBasemaps.js.map