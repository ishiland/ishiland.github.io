/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/_base/lang","dojo/_base/Color","esri/toolbars/draw","esri/layers/GraphicsLayer","esri/graphic","esri/renderers/SimpleRenderer","dojo/text!./Draw/templates/Draw.html","esri/renderers/UniqueValueRenderer","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/layers/FeatureLayer","dojo/topic","dojo/aspect","dojo/i18n!./Draw/nls/resource","dijit/form/Button","xstyle/css!./Draw/css/Draw.css","xstyle/css!./Draw/css/adw-icons.css"],function(e,i,t,n,s,a,r,o,l,d,h,p,c,w,y,u,b,g,T){return e([i,t,n],{widgetsInTemplate:!0,templateString:h,i18n:T,drawToolbar:null,mapClickMode:null,postCreate:function(){this.inherited(arguments),this.drawToolbar=new r(this.map),this.drawToolbar.on("draw-end",s.hitch(this,"onDrawToolbarDrawEnd")),this.createGraphicLayers(),this.own(b.subscribe("mapClickMode/currentSet",s.hitch(this,"setMapClickMode"))),this.parentWidget&&this.parentWidget.toggleable&&this.own(g.after(this.parentWidget,"toggle",s.hitch(this,function(){this.onLayoutChange(this.parentWidget.open)})))},createGraphicLayers:function(){this.pointSymbol=new c(c.STYLE_CIRCLE,10,new w(w.STYLE_SOLID,new a([255,0,0]),1),new a([255,0,0,1])),this.polylineSymbol=new w(w.STYLE_DASH,new a([255,0,0]),1),this.polygonSymbol=new y(y.STYLE_SOLID,new w(w.STYLE_DASHDOT,new a([255,0,0]),2),new a([255,255,0,0])),this.pointGraphics=new o({id:"drawGraphics_point",title:"Draw Graphics"}),this.pointRenderer=new d(this.pointSymbol),this.pointRenderer.label="User drawn points",this.pointRenderer.description="User drawn points",this.pointGraphics.setRenderer(this.pointRenderer),this.map.addLayer(this.pointGraphics),this.polylineGraphics=new o({id:"drawGraphics_line",title:"Draw Graphics"}),this.polylineRenderer=new d(this.polylineSymbol),this.polylineRenderer.label="User drawn lines",this.polylineRenderer.description="User drawn lines",this.polylineGraphics.setRenderer(this.polylineRenderer),this.map.addLayer(this.polylineGraphics),this.polygonGraphics=new u({layerDefinition:{geometryType:"esriGeometryPolygon",fields:[{name:"OBJECTID",type:"esriFieldTypeOID",alias:"OBJECTID",domain:null,editable:!1,nullable:!1},{name:"ren",type:"esriFieldTypeInteger",alias:"ren",domain:null,editable:!0,nullable:!1}]},featureSet:null},{id:"drawGraphics_poly",title:"Draw Graphics",mode:u.MODE_SNAPSHOT}),this.polygonRenderer=new p(new y,"ren",null,null,", "),this.polygonRenderer.addValue({value:1,symbol:new y({color:[255,170,0,255],outline:{color:[255,170,0,255],width:1,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSForwardDiagonal"}),label:"User drawn polygons",description:"User drawn polygons"}),this.polygonGraphics.setRenderer(this.polygonRenderer),this.map.addLayer(this.polygonGraphics)},drawPoint:function(){this.disconnectMapClick(),this.drawToolbar.activate(r.POINT),this.drawModeTextNode.innerText=this.i18n.labels.point},drawCircle:function(){this.disconnectMapClick(),this.drawToolbar.activate(r.CIRCLE),this.drawModeTextNode.innerText=this.i18n.labels.circle},drawLine:function(){this.disconnectMapClick(),this.drawToolbar.activate(r.POLYLINE),this.drawModeTextNode.innerText=this.i18n.labels.polyline},drawFreehandLine:function(){this.disconnectMapClick(),this.drawToolbar.activate(r.FREEHAND_POLYLINE),this.drawModeTextNode.innerText=this.i18n.labels.freehandPolyline},drawPolygon:function(){this.disconnectMapClick(),this.drawToolbar.activate(r.POLYGON),this.drawModeTextNode.innerText=this.i18n.labels.polygon},drawFreehandPolygon:function(){this.disconnectMapClick(),this.drawToolbar.activate(r.FREEHAND_POLYGON),this.drawModeTextNode.innerText=this.i18n.labels.freehandPolygon},disconnectMapClick:function(){b.publish("mapClickMode/setCurrent","draw"),this.enableStopButtons()},connectMapClick:function(){b.publish("mapClickMode/setDefault"),this.disableStopButtons()},onDrawToolbarDrawEnd:function(e){this.drawToolbar.deactivate(),this.drawModeTextNode.innerText=this.i18n.labels.currentDrawModeNone;var i;switch(e.geometry.type){case"point":i=new l(e.geometry),this.pointGraphics.add(i);break;case"polyline":i=new l(e.geometry),this.polylineGraphics.add(i);break;case"polygon":i=new l(e.geometry,null,{ren:1}),this.polygonGraphics.add(i)}this.connectMapClick()},clearGraphics:function(){this.endDrawing(),this.connectMapClick(),this.drawModeTextNode.innerText="None"},stopDrawing:function(){this.drawToolbar.deactivate(),this.drawModeTextNode.innerText="None",this.connectMapClick()},endDrawing:function(){this.pointGraphics.clear(),this.polylineGraphics.clear(),this.polygonGraphics.clear(),this.drawToolbar.deactivate(),this.disableStopButtons()},disableStopButtons:function(){this.stopDrawingButton.set("disabled",!0),this.eraseDrawingButton.set("disabled",!this.noGraphics())},enableStopButtons:function(){this.stopDrawingButton.set("disabled",!1),this.eraseDrawingButton.set("disabled",!this.noGraphics())},noGraphics:function(){return this.pointGraphics.graphics.length>0||(this.polylineGraphics.graphics.length>0||this.polygonGraphics.graphics.length>0)},onLayoutChange:function(e){e||"draw"===this.mapClickMode&&b.publish("mapClickMode/setDefault")},setMapClickMode:function(e){this.mapClickMode=e}})});
//# sourceMappingURL=Draw.js.map