/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/on","dojo/dom-class","dojo/dom-style","dojo/dom-attr","dojo/fx","dojo/html","dijit/Menu","dijit/MenuItem","dojo/topic","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Sublayer.html","dojo/i18n!./../nls/resource"],function(e,t,o,n,i,s,a,l,c,d,r,h,u,p,y,b){return e([u,p],{control:null,sublayerInfo:null,menu:null,icons:null,templateString:y,i18n:b,_expandClickHandler:null,_handlers:[],postCreate:function(){if(this.inherited(arguments),this.control.controlOptions.subLayerInfos&&!this.control.controlOptions.includeUnspecifiedLayers){var e=o.map(this.control.controlOptions.subLayerInfos,function(e){return e.id});o.indexOf(e,this.sublayerInfo.id)<0&&i.add(this.domNode,"layerControlHidden")}this.control.controlOptions.layerIds&&o.indexOf(this.control.controlOptions.layerIds,this.sublayerInfo.id)<0&&i.add(this.domNode,"layerControlHidden");var s=this.checkNode;a.set(s,"data-sublayer-id",this.sublayerInfo.id),i.add(s,this.control.layer.id+"-layerControlSublayerCheck"),-1!==o.indexOf(this.control.layer.visibleLayers,this.sublayerInfo.id)?this._setSublayerCheckbox(!0,s):this._setSublayerCheckbox(!1,s),this._handlers.push(n(s,"click",t.hitch(this,function(e){e.stopPropagation&&e.stopPropagation(),"checked"===a.get(s,"data-checked")?this._setSublayerCheckbox(!1,s):this._setSublayerCheckbox(!0,s),this.control._setVisibleLayers(),this._checkboxScaleRange()}))),c.set(this.labelNode,this.sublayerInfo.name),this._expandClick(),0===this.sublayerInfo.minScale&&0===this.sublayerInfo.maxScale||(this._checkboxScaleRange(),this._handlers.push(this.control.layer.getMap().on("zoom-end",t.hitch(this,"_checkboxScaleRange")))),this.control.controlOptions.subLayerMenu&&this.control.controlOptions.subLayerMenu.length?(this.menu=new d({contextMenuForWindow:!1,targetNodeIds:[this.menuClickNode],leftClickToOpen:!0}),o.forEach(this.control.controlOptions.subLayerMenu,t.hitch(this,"_addMenuItem")),this.menu.startup()):i.add(this.menuClickNode,"hidden")},_addMenuItem:function(e){var o=new r(e);o.set("onClick",t.hitch(this,function(){h.publish("layerControl/"+e.topic,{layer:this.control.layer,subLayer:this.sublayerInfo,iconNode:this.iconNode,menuItem:o})})),this.menu.addChild(o)},_expandClick:function(){var e=this.icons;this._expandClickHandler=n(this.expandClickNode,"click",t.hitch(this,function(){var t=this.expandNode,o=this.expandIconNode;"none"===s.get(t,"display")?(l.wipeIn({node:t,duration:300}).play(),i.replace(o,e.collapse,e.expand)):(l.wipeOut({node:t,duration:300}).play(),i.replace(o,e.expand,e.collapse))})),this._handlers.push(this._expandClickHandler)},_setSublayerCheckbox:function(e,t){t=t||this.checkNode;var o=this.icons;e?(a.set(t,"data-checked","checked"),i.replace(t,o.checked,o.unchecked)):(a.set(t,"data-checked","unchecked"),i.replace(t,o.unchecked,o.checked))},_checkboxScaleRange:function(){var e=this.checkNode,t=this.control.layer.getMap().getScale(),o=this.sublayerInfo.minScale,n=this.sublayerInfo.maxScale;i.remove(e,"layerControlCheckIconOutScale"),(0!==o&&t>o||0!==n&&t<n)&&i.add(e,"layerControlCheckIconOutScale")},destroy:function(){this.inherited(arguments),this._handlers.forEach(function(e){e.remove()})}})});
//# sourceMappingURL=_DynamicSublayer.js.map