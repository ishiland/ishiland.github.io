/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/a11yclick","dojo/_base/lang","dojo/on","dojo/dom-class","dojo/dom-style","esri/dijit/Geocoder","dijit/MenuItem","esri/symbols/SimpleMarkerSymbol","esri/graphic","esri/InfoTemplate","esri/layers/GraphicsLayer","dojo/text!./Geocoder/templates/Geocoder.html","dojo/i18n!./Geocoder/nls/resource","xstyle/css!./Geocoder/css/Geocoder.css"],function(t,e,i,s,o,a,n,d,r,h,c,l,p,g,m,u){return t([e,i],{templateString:m,i18n:u,baseClass:"gis_GeocoderDijit",expanded:!0,collapsible:!1,geocoderOptions:{autoComplete:!0},reverseGeocodeTemplate:['<table class="attrTable">','<tr valign="top">','<td class="attrName">${i18n.labels.address}</td>','<td class="attrValue">${Address}</td>',"</tr>",'<tr valign="top">','<td class="attrName">${i18n.labels.neighborhood}</td>','<td class="attrValue">${Neighborhood}</td>',"</tr>",'<tr valign="top">','<td class="attrName">${i18n.labels.city}</td>','<td class="attrValue">${City}</td>',"</tr>",'<tr valign="top">','<td class="attrName">${i18n.labels.subregion}</td>','<td class="attrValue">${SubRegion}</td>',"</tr>",'<tr valign="top">','<td class="attrName">${i18n.labels.region}</td>','<td class="attrValue">${Region}</td>',"</tr>",'<tr valign="top">','<td class="attrName">${i18n.labels.postalCode}</td>','<td class="attrValue">${Postal}&nbsp;${PostalExt}</td>',"</tr>",'<tr valign="top">','<td class="attrName">${i18n.labels.countryCode}</td>','<td class="attrValue">${CountryCode}</td>',"</tr>",'<tr valign="top">','<td class="attrName">${i18n.labels.locatorName}</td>','<td class="attrValue">${Loc_name}</td>',"</tr>","</table>"].join(""),postCreate:function(){this.inherited(arguments);var t=o.mixin({},this.geocoderOptions,{map:this.map});this.geocoder=new r(t,this.geocoderNode),a(this.geocoder,"select",o.hitch(this,function(t){t.result&&this.show()})),this.collapsible?(a(this.map,"pan-start",o.hitch(this,function(){this.hide()})),this.own(a(this.searchNode,s,o.hitch(this,this.toggle)))):this.expanded=!0,this.geocoder.startup(),!0===this.expanded?this.show():this.hide(),this.mapRightClickMenu&&this.addRightClickMenu(),this.mapExtentSearch&&(this.geocoder.arcgisGeocoder.searchExtent=this.map.extent.getExtent(),this.map.on("extent-change",o.hitch(this,function(t){this.geocoder.arcgisGeocoder.searchExtent=t.extent})))},addRightClickMenu:function(){this.map.on("MouseDown",o.hitch(this,function(t){this.mapRightClickPoint=t.mapPoint})),this.mapRightClickMenu.addChild(new h({label:this.i18n.labels.getAddressHere,onClick:o.hitch(this,"reverseGeocode")})),this.symbol=new c,this.infoTemplate=new p("Location",this.reverseGeocodeTemplate),this.graphics=new g({id:"reverseGeocode"}),this.map.addLayer(this.graphics)},toggle:function(){"block"===d.get(this.searchContainerNode,"display")?this.hide():this.show()},hide:function(){d.set(this.searchContainerNode,"display","none"),n.remove(this.containerNode,"open"),this.geocoder&&this.geocoder.blur()},show:function(){d.set(this.searchContainerNode,"display","block"),n.add(this.containerNode,"open"),this.geocoder&&!this.expanded&&this.geocoder.focus()},reverseGeocode:function(){this.geocoder._task.locationToAddress(this.mapRightClickPoint,1e3,o.hitch(this,"reverseGeocodeComplete"))},reverseGeocodeComplete:function(t){var e=new l(t.location,this.symbol,t.address,this.infoTemplate);this.graphics.add(e),this.map.infoWindow.clearFeatures(),this.map.infoWindow.setTitle(e.getTitle()),this.map.infoWindow.setContent(e.getContent()),this.map.infoWindow.setFeatures([e]);var i=this.map.toScreen(t.location);this.map.infoWindow.show(i,this.map.getInfoWindowAnchor(i)),a.once(this.map.infoWindow,"hide",o.hitch(this,function(){this.graphics.clear()}))}})});
//# sourceMappingURL=Geocoder.js.map