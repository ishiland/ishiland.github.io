/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/dom","esri/arcgis/utils","esri/units"],function(e,i,t,a,n,r){return e(null,{startup:function(){this.inherited(arguments)},createMap:function(){var e=this.config.webMapOptions||{};!e.mapOptions&&this.config.mapOptions&&(e.mapOptions=this.config.mapOptions);var t=a.byId(this.config.layout.map)||"mapCenter",r=n.createMap(this.config.webMapId,t,e);return r.then(i.hitch(this,function(e){this.webMap={clickEventHandle:e.clickEventHandle,clickEventListener:e.clickEventListener,itemInfo:e.itemInfo},this.map=e.map,this._initWebMapLayerInfos(e),this._initWebMapWidgets(e)})),r},_initWebMapLayerInfos:function(e){if(this.config.layerControlLayerInfos)this.layerControlLayerInfos=this.config.layerControlLayerInfos;else if(e.itemInfo&&e.itemInfo.itemData){var a={CSV:"csv",ArcGISMapServiceLayer:"dynamic",ArcGISFeatureLayer:"feature",GeoRSSLayer:"georss",ArcGISImageServiceLayer:"image","esri/layers/ArcGISImageServiceVectorLayer":"imagevector",KML:"kml",ArcGISStreamLayer:"stream",ArcGISTiledMapServiceLayer:"tiled",VectorTileLayer:"vectortile",WebTiledLayer:"webtiled",WMS:"wms"},r=e.itemInfo.itemData.operationalLayers;t.forEach(r,i.hitch(this,function(e){var i=a[e.layerType];i&&this.layerControlLayerInfos.push({layer:e.layerObject,type:i,title:e.title})}))}this.config.legendLayerInfos?this.legendLayerInfos=this.config.legendLayerInfos:this.legendLayerInfos=n.getLegendLayers(e)},_initWebMapWidgets:function(e){if(e.itemInfo&&e.itemInfo.itemData){var t=this.config.widgets,a=e.itemInfo.itemData.bookmarks;if(a&&a.length>0&&(t.bookmarks=this.mixinDeep({include:!0,id:"bookmarks",type:"titlePane",path:"gis/dijit/Bookmarks",title:"Bookmarks",open:!1,position:999,options:{map:!0,editable:!1,bookmarks:a}},t.bookmarks||{})),e.itemInfo.itemData.applicationProperties){var n=e.itemInfo.itemData.applicationProperties.viewing;n.basemapGallery&&n.basemapGallery.enabled&&(t.basemaps&&t.basemaps.include||(t.basemapGallery=this.mixinDeep({include:!0,id:"basemapGallery",type:"domNode",path:"gis/dijit/BasemapGallery",srcNodeRef:"basemapsDijit",options:{map:!0}},t.basemapGallery||{}))),n.routing&&n.routing.enabled&&(t.directions=this.mixinDeep({include:!0,id:"directions",type:"titlePane",path:"gis/dijit/Directions",title:"Directions",open:!1,position:999,options:{map:!0,mapRightClickMenu:!0,options:{routeTaskUrl:"https://sampleserver3.arcgisonline.com/ArcGIS/rest/services/Network/USA/NAServer/Route",routeParams:{directionsLanguage:"en-US",directionsLengthUnits:r.MILES},active:!1}}},t.directions||{})),n.measure&&n.measure.enabled&&(t.measure=this.mixinDeep({include:!0,id:"measurement",type:"titlePane",path:"gis/dijit/Measurement",title:"Measurement",open:!1,position:999,options:{map:!0,mapClickMode:!0,defaultAreaUnit:r.SQUARE_MILES,defaultLengthUnit:r.MILES}},t.measure||{})),n.search&&n.search.enabled&&(t.search=this.mixinDeep({include:!0,type:"domNode",path:"esri/dijit/Search",srcNodeRef:"geocoderButton",options:{map:!0,visible:!0,enableButtonMode:!0,expanded:!0,disablePlaceFinder:n.search.disablePlaceFinder,hintText:n.search.hintText,layers:n.search.layers}},t.search||{}))}if(e.itemInfo.itemData.widgets){var s=e.itemInfo.itemData.widgets.timeSlider;s&&(t.timeSlider=this.mixinDeep({include:!0,type:"domNode",path:"esri/dijit/TimeSlider",srcNodeRef:"geocoderButton",options:i.mixin({map:!0},s)},t.slider||{}))}}}})});
//# sourceMappingURL=_WebMapMixin.js.map