/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/_base/lang","dojo/_base/array","dojo/query","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/aspect","dijit/registry","put-selector/put","viewer/sidebar/SidebarTab","dojo/text!./templates/Sidebar.html","xstyle/css!./css/Sidebar.css","dojo/NodeList-traverse"],function(t,e,i,o,n,s,a,d,r,h,c,l,b,p){return t([e,i],{templateString:p,baseClass:"sidebar",viewPadding:{top:0,left:0,right:0,bottom:0},showCloseIcon:!0,collapseSyncNode:null,postCreate:function(){this.inherited(arguments),this.tabs=[],this.collapseSyncNode&&(a.contains(this.domNode,"collapsed")&&l(this.mapContainer,".sidebar-collapsed"),r(this.collapseSyncNode,"transitionend, oTransitionEnd, webkitTransitionEnd, animationend, webkitAnimationEnd",o.hitch(this,"_setViewPadding"))),h.before(this.map,"setExtent",o.hitch(this,"_viewPaddingHandler")),r(this.domNode,"transitionend, oTransitionEnd, webkitTransitionEnd, animationend, webkitAnimationEnd",o.hitch(this,"_resizeActiveTab")),r(window,"resize",o.hitch(this,function(){window.setTimeout(o.hitch(this,"_resizeActiveTab"),300)}))},createTab:function(t){(t=t||{}).open=t.open||!1,t.baseClass=this.baseClass,t.showCloseIcon=this.showCloseIcon,t.tabsContainerNode=this.tabsContainerNode,t.tabsButtonNode=this.tabsButtonNode;var e=new b(t);return e.watch("open",o.hitch(this,"checkTabs",e)),t.open&&e.openTab(),this.tabs.push(e),e},checkTabs:function(t){n.forEach(this.tabs,function(e){e.get("id")!==t.get("id")&&e.closeTab(!0)}),t.get("open")?(a.add(this.tabsButtonNode,"active"),a.remove(this.domNode,"collapsed"),a.remove(this.mapContainer,"sidebar-collapsed")):(a.remove(this.tabsButtonNode,"active"),a.add(this.domNode,"collapsed"),a.add(this.mapContainer,"sidebar-collapsed"))},_setViewPadding:function(){var t=d.getContentBox(this.domNode);this.viewPadding={top:0,left:t.w+t.l,right:0,bottom:0},this._viewPaddingHandler(this.map.extent)},_viewPaddingHandler:function(t){var e=this.map,i=this.viewPadding,o=e.width-i.left-i.right,n=e.height-i.top-i.bottom,s=Math.max(t.getWidth()/o,t.getHeight()/n),a=t.getCenter(),d=e.extent.expand(s/(e.extent.getWidth()/e.width));return d=d.centerAt({x:a.x-.5*(i.left-i.right)*s,y:a.y-.5*(i.top-i.bottom)*s}),[d]},_resizeActiveTab:function(){var t=n.filter(this.tabs,function(t){return a.contains(t.contentNode,"active")});if(t&&t.length>0){var e=s(t[0].contentNode);this._resizeWidgetsInNodeList(e);var i=e.children();this._resizeWidgetsInNodeList(i)}},_resizeWidgetsInNodeList:function(t){n.forEach(t,function(t){var e=c.findWidgets(t);n.forEach(e,function(t){t.resize&&"function"==typeof t.resize&&window.setTimeout(function(){t.resize()},50)})})}})});
//# sourceMappingURL=Sidebar.js.map