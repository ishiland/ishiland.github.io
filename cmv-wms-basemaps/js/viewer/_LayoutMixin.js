/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/_base/array","dojo/on","dojo/aspect","dojo/dom","dojo/query","dojo/dom-style","dojo/dom-class","dojo/dom-geometry","dojo/sniff","dojo/Deferred","put-selector","dijit/layout/BorderContainer","dijit/layout/ContentPane","esri/dijit/PopupMobile","dojo/text!./templates/mapOverlay.html"],function(e,t,i,o,s,n,a,r,d,l,p,h,c,u,f,g,b,m){return e(null,{panes:{left:{id:"sidebarLeft",placeAt:"outer",collapsible:!0,region:"left"},center:{id:"mapCenter",placeAt:"outer",region:"center",content:m}},collapseButtons:{},loadConfig:function(){return this.detectTouchDevices(),this.inherited(arguments)},postConfig:function(){return this.layoutDeferred=new c,this.inherited(arguments)},startup:function(){this.config.layout=this.config.layout||{},this.addTopics(),this.addTitles(),this.setPhoneInfoWindow(),this.initPanes(),this.mapDeferred.then(t.hitch(this,"createPanes")),this.layoutDeferred.resolve(),this.inherited(arguments)},addTopics:function(){i.subscribe("viewer/togglePane",t.hitch(this,function(e){this.togglePane(e.pane,e.show,e.suppressEvent)})),i.subscribe("viewer/loadWidget",t.hitch(this,function(e){this.widgetLoader(e.options,e.position)})),this.config.isDebug&&i.subscribe("viewer/handleError",t.hitch(this,"handleError")),i.subscribe("mapClickMode/setCurrent",t.hitch(this,function(e){this.mapClickMode.current=e,i.publish("mapClickMode/currentSet",e)})),i.subscribe("mapClickMode/setDefault",t.hitch(this,function(){i.publish("mapClickMode/setCurrent",this.mapClickMode.defaultMode)}))},addTitles:function(){if(this.config.titles){var e=this.config.titles;if(e.header){var t=a.byId("headerTitleSpan");t&&(t.innerHTML=e.header)}if(e.subHeader){var i=a.byId("subHeaderTitleSpan");i&&(i.innerHTML=e.subHeader)}e.pageTitle&&(document.title=e.pageTitle)}},initPanes:function(){var e,i=this.config.panes||{};this.defaultPanes=t.clone(this.panes);for(e in this.panes)this.defaultPanes.hasOwnProperty(e)&&(i[e]=t.mixin(this.defaultPanes[e],i[e]));var o=a.byId(this.config.layout.container)||document.body;this.panes.outer=new f({id:"borderContainerOuter",design:"sidebar",gutters:!1}).placeAt(o);var s,n,r;for(e in i)i.hasOwnProperty(e)&&(s=t.clone(i[e]),n=this.panes[s.placeAt]||this.panes.outer,s.id=s.id||e,r=s.type,delete s.placeAt,delete s.type,delete s.collapsible,n&&("border"===r?this.panes[e]=new f(s).placeAt(n):s.region&&(this.panes[e]=new g(s).placeAt(n))));this.panes.outer.startup()},createPanes:function(){var e,i=this.config.panes||{};for(e in this.panes)this.defaultPanes.hasOwnProperty(e)&&(i[e]=t.mixin(this.defaultPanes[e],i[e]));this.collapseButtonsPane=this.config.collapseButtonsPane||"outer";for(e in i)if(i.hasOwnProperty(e)){if(i[e].collapsible&&(this.collapseButtons[e]=u(this.panes[this.collapseButtonsPane].domNode,"div.sidebarCollapseButton.sidebar"+e+"CollapseButton.sidebarCollapseButton"+("bottom"===e||"top"===e?"Vert":"Horz")+" div.dijitIcon.button.close").parentNode,s(this.collapseButtons[e],"click",t.hitch(this,"togglePane",e,null,!1)),this.positionSideBarToggle(e),"outer"===this.collapseButtonsPane)){var o=this.panes[e]._splitterWidget;o&&(n.after(o,"_startDrag",t.hitch(this,"_splitterStartDrag",e)),n.after(o,"_stopDrag",t.hitch(this,"_splitterStopDrag",e)))}void 0!==i[e].open&&this.togglePane(e,i[e].open,!0),"center"!==e&&this.panes[e]._splitterWidget&&(l.add(this.map.root.parentNode,"pane"+e),"right"===e&&this.panes.top&&l.add(this.panes.top.domNode,"pane"+e),"right"===e&&this.panes.bottom&&l.add(this.panes.bottom.domNode,"pane"+e),"left"===e&&this.panes.top&&l.add(this.panes.top.domNode,"pane"+e),"left"===e&&this.panes.bottom&&l.add(this.panes.bottom.domNode,"pane"+e))}this.resizeLayout()},togglePane:function(e,t,o){if(this.panes[e]){var s=this.panes[e].domNode;if(s){var n,a=d.get(s,"display");if("string"!=typeof t||"none"!==t&&"block"!==t)if("boolean"==typeof t)n=t?"block":"none";else{if(void 0!==t&&null!==t)return void this.handleError({source:"_LayoutMixin",error:'Invalid type passed as "show" property of "togglePane" function : '+typeof t});n="none"===a?"block":"none"}else n=t;t="block"===n,n!==a&&(d.set(s,"display",n),this.panes[e]._splitterWidget&&d.set(this.panes[e]._splitterWidget.domNode,"display",n),this.positionSideBarToggle(e),this.panes.outer&&this.panes.outer.resize(),o||i.publish("viewer/onTogglePane",{pane:e,show:t}))}}},positionSideBarToggle:function(e){var t=this.panes[e],i=this.collapseButtons[e];if(t&&i){var o=d.get(t.domNode,"display"),s="none"===o?"close":"open",n="none"===o?"open":"close";if(l.remove(i.children[0],s),l.add(i.children[0],n),"outer"===this.collapseButtonsPane){var a=t._splitterWidget?0:-1,r="bottom"===e||"top"===e?"h":"w";"block"===o&&(a+=p.getMarginBox(t.domNode)[r]),t._splitterWidget&&(a+=p.getMarginBox(t._splitterWidget.domNode)[r]),d.set(i,e,a.toString()+"px"),d.set(i,"display","block")}}},repositionSideBarButtons:function(){var e=["left","right","top","bottom"];o.forEach(e,t.hitch(this,function(e){this.positionSideBarToggle(e)}))},resizeLayout:function(){this.panes.outer.resize()},_splitterStartDrag:function(e){var t=this.collapseButtons[e];d.set(t,"display","none")},_splitterStopDrag:function(e){this.positionSideBarToggle(e)},detectTouchDevices:function(){h("touch")&&(h("ios")||h("android")||h("bb"))&&(h.add("mobile",!0),screen.availWidth<500||screen.availHeight<500?h.add("phone",!0):h.add("tablet",!0))},setPhoneInfoWindow:function(){h("phone")&&!this.config.mapOptions.infoWindow&&(this.config.mapOptions.infoWindow=new b(null,u("div")))}})});
//# sourceMappingURL=_LayoutMixin.js.map