/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/_base/array","dojo/on","dojo/aspect","dojo/dom","dojo/query","dojo/dom-style","dojo/dom-class","dojo/dom-geometry","dojo/sniff","dojo/Deferred","put-selector","dijit/layout/BorderContainer","dijit/layout/ContentPane","esri/dijit/PopupMobile","dojo/text!./templates/mapOverlay.html"],function(e,a,r,t,o,s,d,i,l,p,h,n,c,u,f,g,b,m){return e(null,{panes:{left:{id:"sidebarLeft",placeAt:"outer",collapsible:!0,region:"left"},center:{id:"mapCenter",placeAt:"outer",region:"center",content:m}},collapseButtons:{},loadConfig:function(){return this.detectTouchDevices(),this.inherited(arguments)},postConfig:function(){return this.layoutDeferred=new c,this.inherited(arguments)},startup:function(){this.config.layout=this.config.layout||{},this.addTopics(),this.addTitles(),this.setPhoneInfoWindow(),this.initPanes(),this.mapDeferred.then(a.hitch(this,"createPanes")),this.layoutDeferred.resolve(),this.inherited(arguments)},addTopics:function(){r.subscribe("viewer/togglePane",a.hitch(this,function(e){this.togglePane(e.pane,e.show,e.suppressEvent)})),r.subscribe("viewer/loadWidget",a.hitch(this,function(e){this.widgetLoader(e.options,e.position)})),this.config.isDebug&&r.subscribe("viewer/handleError",a.hitch(this,"handleError")),r.subscribe("mapClickMode/setCurrent",a.hitch(this,function(e){this.mapClickMode.current=e,r.publish("mapClickMode/currentSet",e)})),r.subscribe("mapClickMode/setDefault",a.hitch(this,function(){r.publish("mapClickMode/setCurrent",this.mapClickMode.defaultMode)}))},addTitles:function(){if(this.config.titles){var e=this.config.titles;if(e.header){var t=d.byId("headerTitleSpan");t&&(t.innerHTML=e.header)}if(e.subHeader){var i=d.byId("subHeaderTitleSpan");i&&(i.innerHTML=e.subHeader)}e.pageTitle&&(document.title=e.pageTitle)}},initPanes:function(){var e,t=this.config.panes||{};for(e in this.defaultPanes=a.clone(this.panes),this.panes)this.defaultPanes.hasOwnProperty(e)&&(t[e]=a.mixin(this.defaultPanes[e],t[e]));var i,o,s,n=d.byId(this.config.layout.container)||document.body;for(e in this.panes.outer=new f({id:"borderContainerOuter",design:"sidebar",gutters:!1}).placeAt(n),t)t.hasOwnProperty(e)&&(i=a.clone(t[e]),o=this.panes[i.placeAt]||this.panes.outer,i.id=i.id||e,s=i.type,delete i.placeAt,delete i.type,delete i.collapsible,o&&("border"===s?this.panes[e]=new f(i).placeAt(o):i.region&&(this.panes[e]=new g(i).placeAt(o))));this.panes.outer.startup()},createPanes:function(){var e,t=this.config.panes||{};for(e in this.panes)this.defaultPanes.hasOwnProperty(e)&&(t[e]=a.mixin(this.defaultPanes[e],t[e]));for(e in this.collapseButtonsPane=this.config.collapseButtonsPane||"outer",t)if(t.hasOwnProperty(e)){if(t[e].collapsible&&(this.collapseButtons[e]=u(this.panes[this.collapseButtonsPane].domNode,"div.sidebarCollapseButton.sidebar"+e+"CollapseButton.sidebarCollapseButton"+("bottom"===e||"top"===e?"Vert":"Horz")+" div.dijitIcon.button.close").parentNode,o(this.collapseButtons[e],"click",a.hitch(this,"togglePane",e,null,!1)),this.positionSideBarToggle(e),"outer"===this.collapseButtonsPane)){var i=this.panes[e]._splitterWidget;i&&(s.after(i,"_startDrag",a.hitch(this,"_splitterStartDrag",e)),s.after(i,"_stopDrag",a.hitch(this,"_splitterStopDrag",e)))}void 0!==t[e].open&&this.togglePane(e,t[e].open,!0),"center"!==e&&this.panes[e]._splitterWidget&&(p.add(this.map.root.parentNode,"pane"+e),"right"===e&&this.panes.top&&p.add(this.panes.top.domNode,"pane"+e),"right"===e&&this.panes.bottom&&p.add(this.panes.bottom.domNode,"pane"+e),"left"===e&&this.panes.top&&p.add(this.panes.top.domNode,"pane"+e),"left"===e&&this.panes.bottom&&p.add(this.panes.bottom.domNode,"pane"+e))}this.resizeLayout()},togglePane:function(e,t,i){if(this.panes[e]){var o=this.panes[e].domNode;if(o){var s,n=l.get(o,"display");if("string"!=typeof t||"none"!==t&&"block"!==t)if("boolean"==typeof t)s=t?"block":"none";else{if(null!=t)return void this.handleError({source:"_LayoutMixin",error:'Invalid type passed as "show" property of "togglePane" function : '+typeof t});s="none"===n?"block":"none"}else s=t;t="block"===s,s!==n&&(l.set(o,"display",s),this.panes[e]._splitterWidget&&l.set(this.panes[e]._splitterWidget.domNode,"display",s),this.positionSideBarToggle(e),this.panes.outer&&this.panes.outer.resize(),i||r.publish("viewer/onTogglePane",{pane:e,show:t}))}}},positionSideBarToggle:function(e){var t=this.panes[e],i=this.collapseButtons[e];if(t&&i){var o=l.get(t.domNode,"display"),s="none"===o?"close":"open",n="none"===o?"open":"close";if(p.remove(i.children[0],s),p.add(i.children[0],n),"outer"===this.collapseButtonsPane){var a=t._splitterWidget?0:-1,r="bottom"===e||"top"===e?"h":"w";"block"===o&&(a+=h.getMarginBox(t.domNode)[r]),t._splitterWidget&&(a+=h.getMarginBox(t._splitterWidget.domNode)[r]),l.set(i,e,a.toString()+"px"),l.set(i,"display","block")}}},repositionSideBarButtons:function(){t.forEach(["left","right","top","bottom"],a.hitch(this,function(e){this.positionSideBarToggle(e)}))},resizeLayout:function(){this.panes.outer.resize()},_splitterStartDrag:function(e){var t=this.collapseButtons[e];l.set(t,"display","none")},_splitterStopDrag:function(e){this.positionSideBarToggle(e)},detectTouchDevices:function(){n("touch")&&(n("ios")||n("android")||n("bb"))&&(n.add("mobile",!0),screen.availWidth<500||screen.availHeight<500?n.add("phone",!0):n.add("tablet",!0))},setPhoneInfoWindow:function(){n("phone")&&!this.config.mapOptions.infoWindow&&(this.config.mapOptions.infoWindow=new b(null,u("div")))}})});
//# sourceMappingURL=_LayoutMixin.js.map