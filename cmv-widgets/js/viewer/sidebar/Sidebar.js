/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/_base/lang","dojo/_base/array","dojo/query","dojo/dom-class","dojo/dom-geometry","dojo/on","dojo/aspect","dijit/registry","put-selector/put","viewer/sidebar/SidebarTab","dojo/text!./templates/Sidebar.html","xstyle/css!./css/Sidebar.css","dojo/NodeList-traverse"],function(e,t,i,o,n,s,d,a,h,r,c,l,b,p){return e([t,i],{templateString:p,baseClass:"sidebar",viewPadding:{top:0,left:0,right:0,bottom:0},showCloseIcon:!0,collapseSyncNode:null,postCreate:function(){this.inherited(arguments),this.hide(),this.tabs=[],this.collapseSyncNode&&h(this.collapseSyncNode,"transitionend, oTransitionEnd, webkitTransitionEnd, animationend, webkitAnimationEnd",o.hitch(this,"_setViewPadding")),r.before(this.map,"setExtent",o.hitch(this,"_viewPaddingHandler")),h(this.domNode,"transitionend, oTransitionEnd, webkitTransitionEnd, animationend, webkitAnimationEnd",o.hitch(this,"_resizeActiveTab")),h(window,"resize",o.hitch(this,function(){window.setTimeout(o.hitch(this,"_resizeActiveTab"),300)}))},show:function(){d.remove(this.domNode,"hidden"),this.collapseSyncNode&&(l(this.collapseSyncNode,">",this.map._slider),d.contains(this.domNode,"collapsed")&&d.add(this.mapContainer,"sidebar-collapsed"))},hide:function(){d.add(this.domNode,"hidden"),d.remove(this.mapContainer,"sidebar-collapsed")},createTab:function(e){(e=e||{}).open=e.open||!1,e.baseClass=this.baseClass,e.showCloseIcon=this.showCloseIcon,e.tabsContainerNode=this.tabsContainerNode,e.tabsButtonNode=this.tabsButtonNode;var t=new b(e);return t.watch("open",o.hitch(this,"checkTabs",t)),e.open&&t.openTab(),this.tabs.push(t),t},checkTabs:function(t){n.forEach(this.tabs,function(e){e.get("id")!==t.get("id")&&e.closeTab(!0)}),t.get("open")?(d.add(this.tabsButtonNode,"active"),d.remove(this.domNode,"collapsed"),d.remove(this.mapContainer,"sidebar-collapsed")):(d.remove(this.tabsButtonNode,"active"),d.add(this.domNode,"collapsed"),d.add(this.mapContainer,"sidebar-collapsed"))},_setViewPadding:function(){var e=a.getContentBox(this.domNode);this.viewPadding={top:0,left:e.w+e.l,right:0,bottom:0},this._viewPaddingHandler(this.map.extent)},_viewPaddingHandler:function(e){if(e.spatialReference!==this.map.extent.spatialReference)return[e];var t=this.map,i=this.viewPadding,o=t.width-i.left-i.right,n=t.height-i.top-i.bottom,s=Math.max(e.getWidth()/o,e.getHeight()/n),d=e.getCenter(),a=t.extent.expand(s/(t.extent.getWidth()/t.width));return[a=a.centerAt({x:d.x-.5*(i.left-i.right)*s,y:d.y-.5*(i.top-i.bottom)*s})]},_resizeActiveTab:function(){var e=n.filter(this.tabs,function(e){return d.contains(e.contentNode,"active")});if(e&&0<e.length){var t=s(e[0].contentNode);this._resizeWidgetsInNodeList(t);var i=t.children();this._resizeWidgetsInNodeList(i)}},_resizeWidgetsInNodeList:function(e){n.forEach(e,function(e){var t=c.findWidgets(e);n.forEach(t,function(e){e.resize&&"function"==typeof e.resize&&window.setTimeout(function(){e.resize()},50)})})}})});
//# sourceMappingURL=Sidebar.js.map