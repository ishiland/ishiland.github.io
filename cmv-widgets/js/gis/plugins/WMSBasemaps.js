/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/_base/lang","dijit/DropDownMenu","dijit/MenuItem","dojo/_base/array","dojo/topic","dojox/lang/functional","dojo/text!./WMSBasemaps/templates/WMSBasemaps.html","esri/dijit/BasemapGallery","dojo/i18n!./WMSBasemaps/nls/resource","dijit/form/DropDownButton","xstyle/css!./WMSBasemaps/css/WMSBasemaps.css"],function(a,s,e,t,m,i,p,n,o,r,h,d,c){return a([s,e,t],{templateString:h,widgetsInTemplate:!0,baseClass:"basemapWidget",i18n:c,mode:"",title:c.title,mapStartBasemap:"",basemapsToShow:[],validBasemaps:[],postCreate:function(){this.inherited(arguments),this.initializeBasemaps()},initializeBasemaps:function(){this.currentBasemap=this.mapStartBasemap||null,"custom"===this.mode&&(this.gallery=new d({map:this.map,showArcGISBasemaps:!1,basemaps:r.map(this.basemaps,function(a){return a.basemap})}),this.gallery.startup()),this.menu=new i({class:this.baseClass+"-menu",style:"display: none;"}),this.buildMenu()},buildMenu:function(){n.forEach(this.basemapsToShow,function(i){if(this.basemaps.hasOwnProperty(i)){var a=new p({id:i,label:this.basemaps[i].title,iconClass:i===this.mapStartBasemap?"selectedIcon":"emptyIcon",onClick:m.hitch(this,function(){var a=this.basemaps[i];if("agol"===this.mode){if(a.basemap?this.addWMSLayer(a):this.map.setBasemap(i),this.currentBasemap.basemap){var s=this.map.getLayer(this.currentBasemap.basemap.id);!a.basemap&&this.currentBasemap.basemap?this.map.removeLayer(s):a.basemap&&this.currentBasemap.basemap&&a.basemap.id!==this.currentBasemap.basemap.id&&this.map.removeLayer(s)}}else if("custom"===this.mode&&(a.basemap.layerInfos?this.addWMSLayer(a):this.gallery.select(i),this.currentBasemap.basemap)){var e=this.map.getLayer(this.currentBasemap.basemap.id);e&&e.id!==a.basemap.id&&this.map.removeLayer(e)}this.currentBasemap=a;var t=this.menu.getChildren();n.forEach(t,function(a){a.id===i?a.set("iconClass","selectedIcon"):a.set("iconClass","emptyIcon")})})});this.menu.addChild(a)}},this),this.dropDownButton.set("dropDown",this.menu)},startup:function(){this.inherited(arguments),"custom"===this.mode?this.map.getBasemap()!==this.mapStartBasemap&&this.gallery.select(this.mapStartBasemap):this.mapStartBasemap&&this.map.getBasemap()!==this.mapStartBasemap&&this.map.setBasemap(this.mapStartBasemap)},addWMSLayer:function(a){this.map.addLayer(a.basemap,1);var s=this.map.getLayer(a.basemap.id);s.on("update-start",m.hitch(this,function(){this.dropDownButton.set("iconClass","fa fa-sync fa-spin")})),s.on("update-end",m.hitch(this,function(){this.dropDownButton.set("iconClass","basemapsIcon")})),s.on("error",function(a){})}})});
//# sourceMappingURL=WMSBasemaps.js.map