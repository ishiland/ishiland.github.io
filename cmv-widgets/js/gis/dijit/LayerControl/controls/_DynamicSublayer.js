/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/on","dojo/dom-class","dojo/dom-style","dojo/dom-attr","dojo/fx","dojo/html","dijit/Menu","dijit/MenuItem","dojo/topic","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/Sublayer.html","dojo/i18n!./../nls/resource"],function(e,n,i,a,s,c,l,d,r,h,o,u,t,p,y,b){return e([t,p],{control:null,sublayerInfo:null,parentLayerId:null,menu:null,icons:null,templateString:y,i18n:b,_expandClickHandler:null,_handlers:[],postCreate:function(){if(this.inherited(arguments),this.control.controlOptions.subLayerInfos&&!this.control.controlOptions.includeUnspecifiedLayers){var e=i.map(this.control.controlOptions.subLayerInfos,function(e){return e.id});i.indexOf(e,this.sublayerInfo.id)<0&&s.add(this.domNode,"layerControlHidden")}this.control.controlOptions.layerIds&&i.indexOf(this.control.controlOptions.layerIds,this.sublayerInfo.id)<0&&s.add(this.domNode,"layerControlHidden");var t=this.checkNode;l.set(t,"data-sublayer-id",this.sublayerInfo.id),s.add(t,this.control.layer.id+"-layerControlSublayerCheck"),this.parentLayerId=this.sublayerInfo.parentLayerId;var o=-1!==i.indexOf(this.control.layer.visibleLayers,this.sublayerInfo.id);this._setSublayerCheckbox(o,t),this._handlers.push(a(t,"click",n.hitch(this,function(e){e.stopPropagation&&e.stopPropagation(),"checked"===l.get(t,"data-checked")?this._setSublayerCheckbox(!1,t):this._setSublayerCheckbox(!0,t),this.control._setVisibleLayers(),this._checkboxScaleRange()}))),r.set(this.labelNode,this.sublayerInfo.name),this._expandClick(),0===this.sublayerInfo.minScale&&0===this.sublayerInfo.maxScale||(this._checkboxScaleRange(),this._handlers.push(this.control.layer.getMap().on("zoom-end",n.hitch(this,"_checkboxScaleRange")))),this.control.controlOptions.subLayerMenu&&this.control.controlOptions.subLayerMenu.length?(this.menu=new h({contextMenuForWindow:!1,targetNodeIds:[this.menuClickNode],leftClickToOpen:!0}),i.forEach(this.control.controlOptions.subLayerMenu,n.hitch(this,"_addMenuItem")),this.menu.startup()):s.add(this.menuClickNode,"hidden")},_addMenuItem:function(e){var t=new o(e);t.set("onClick",n.hitch(this,function(){u.publish("layerControl/"+e.topic,{layer:this.control.layer,subLayer:this.sublayerInfo,iconNode:this.iconNode,menuItem:t})})),this.menu.addChild(t)},_expandClick:function(){var o=this.icons;this._expandClickHandler=a(this.expandClickNode,"click",n.hitch(this,function(){var e=this.expandNode,t=this.expandIconNode;"none"===c.get(e,"display")?(d.wipeIn({node:e,duration:300}).play(),s.replace(t,o.collapse,o.expand)):(d.wipeOut({node:e,duration:300}).play(),s.replace(t,o.expand,o.collapse))})),this._handlers.push(this._expandClickHandler)},_setSublayerCheckbox:function(e,t){t=t||this.checkNode;var o=this.icons;e?(l.set(t,"data-checked","checked"),s.replace(t,o.checked,o.unchecked)):(l.set(t,"data-checked","unchecked"),s.replace(t,o.unchecked,o.checked))},_checkboxScaleRange:function(){var e=this.checkNode,t=this.control.layer.getMap().getScale(),o=this.sublayerInfo.minScale,n=this.sublayerInfo.maxScale;s.remove(e,"layerControlCheckIconOutScale"),(0!==o&&o<t||0!==n&&t<n)&&s.add(e,"layerControlCheckIconOutScale")},_isVisible:function(){return"checked"===l.get(this.checkNode,"data-checked")},destroy:function(){this.inherited(arguments),this._handlers.forEach(function(e){e.remove()})}})});
//# sourceMappingURL=_DynamicSublayer.js.map