/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/_base/lang","dojo/_base/array","dojo/topic","dijit/DropDownMenu","dijit/MenuItem","esri/basemaps","esri/dijit/BasemapGallery","dojo/text!./Basemaps/templates/Basemaps.html","dojo/i18n!./Basemaps/nls/resource","dijit/form/DropDownButton","xstyle/css!./Basemaps/css/Basemaps.css"],function(s,a,e,t,i,p,l,m,n,h,r,o,c){return s([a,e,t],{templateString:o,widgetsInTemplate:!0,i18n:c,title:c.title,baseClass:"basemapWidget",basemaps:{},currentBasemap:null,mapStartBasemap:null,basemapsToShow:null,galleryOptions:{basemapIds:null,basemaps:null,basemapsGroup:null,bingMapsKey:null,portalUrl:null,referenceIds:null,showArcGISBasemaps:!1},postCreate:function(){this.inherited(arguments),this.initializeBasemaps(),this.createBasemapGallery(),l.subscribe("basemaps/updateBasemap",i.hitch(this,"updateBasemap"))},initializeBasemaps:function(){if(this.galleryOptions.basemaps)this.basemapsToShow=this.basemapsToShow||p.map(this.galleryOptions.basemaps,function(s){return s.id});else{(!this.basemaps||Object.keys(this.basemaps).length<1)&&(this.basemaps=i.clone(h),this.galleryOptions.showArcGISBasemaps=!1),this.basemapsToShow=this.basemapsToShow||Object.keys(this.basemaps);var t=[];p.forEach(this.basemapsToShow,i.hitch(this,function(s){var a=this.basemaps[s];if(a.basemap&&"esri.dijit.Basemap"===a.basemap.declaredClass){var e=a.basemap;e.title=a.title||e.title,e.id=s,t.push(e)}else h[s]||(a.basemap.title=a.title||a.basemap.title,h[s]=a.basemap),a.title=a.title||h[s].title,this.galleryOptions.showArcGISBasemaps=!1})),this.galleryOptions.basemaps=t}this.mapStartBasemap=this.mapStartBasemap||this.map.getBasemap(),p.indexOf(this.basemapsToShow,this.mapStartBasemap)<0&&(this.mapStartBasemap=this.basemapsToShow[0])},createBasemapGallery:function(){var s=i.mixin({map:this.map},this.galleryOptions);this.gallery=new r(s),this.gallery.startup(),this.galleryOptions.showArcGISBasemaps?this.gallery.on("load",i.hitch(this,"buildMenu")):this.buildMenu()},buildMenu:function(){this.menu=new m({class:this.baseClass+"-menu",style:"display: none;"}),p.forEach(this.basemapsToShow,function(s){if(this.basemaps.hasOwnProperty(s)){var a=new n({id:s,label:this.basemaps[s].title,iconClass:s===this.mapStartBasemap?"selectedIcon":"emptyIcon",onClick:i.hitch(this,"updateBasemap",s)});this.menu.addChild(a)}},this),this.dropDownButton.set("dropDown",this.menu),this.setStartingBasemap()},setStartingBasemap:function(){this.mapStartBasemap&&(this.gallery.get(this.mapStartBasemap)||h[this.mapStartBasemap])&&this.updateBasemap(this.mapStartBasemap)},updateBasemap:function(a){if(a!==this.currentBasemap&&-1!==p.indexOf(this.basemapsToShow,a)){if(this.gallery.get(a))this.gallery.select(a);else{if(!h[a])return void l.publish("viewer/error","Invalid basemap selected.");this.gallery._removeBasemapLayers(),this.gallery._removeReferenceLayer(),this.map.setBasemap(a)}this.currentBasemap=a;var s=this.menu.getChildren();p.forEach(s,function(s){s.id===a?s.set("iconClass","selectedIcon"):s.set("iconClass","emptyIcon")})}}})});
//# sourceMappingURL=Basemaps.js.map