/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/_base/lang","dojo/html","dojo/dom-style","dojo/number","dojo/topic","proj4js/proj4","xstyle/css!./MapInfo/css/MapInfo.css"],function(s,o,t,a,i,d,r,n,h){return s([o,t],{map:null,mode:"map",firstCoord:"x",unitScale:2,showScale:!1,showZoom:!1,xLabel:"X:",yLabel:"Y:",scaleLabel:"1:",zoomLabel:"Z:",minWidth:0,proj4BaseURL:"https://epsg.io/",proj4Catalog:null,proj4Wkid:null,proj4CustomURL:null,_mode:0,_projection:null,_projectionLoaded:!1,constructor:function(o){s.safeMixin(this,o||{});var t='<div class="gis-dijit-MapInfo">';this.showScale&&(t+='${scaleLabel}<span data-dojo-attach-point="scaleNode"></span>&nbsp;&nbsp;'),this.showZoom&&(t+='${zoomLabel}<span data-dojo-attach-point="zoomNode"></span>&nbsp;&nbsp;');var i=this.firstCoord;"x"===i?t+='${xLabel}<span data-dojo-attach-point="xNode"></span>&nbsp;&nbsp;${yLabel}<span data-dojo-attach-point="yNode"></span>':"y"===i?t+='${yLabel}<span data-dojo-attach-point="yNode"></span>&nbsp;&nbsp;${xLabel}<span data-dojo-attach-point="xNode"></span>':(this.firstCoord="x",t+='${xLabel}<span data-dojo-attach-point="xNode"></span>&nbsp;&nbsp;${yLabel}<span data-dojo-attach-point="yNode"></span>'),t+="</div>",this.templateString=t},postCreate:function(){var o=this.map;if(!o)return n.publish("viewer/handleError",{source:"MapInfo",error:"A map reference is required"}),void this.destroy();o.loaded?this._initialize(o):o.on("load",a.hitch(this,"_initialize",o))},_initialize:function(o){var t=o.spatialReference.wkid,i=this.mode;if(102100===t&&"dec"!==i&&"dms"!==i)this._mode=0;else if(102100===t)this._mode=1;else if(4326===t)this._mode=2;else if("dec"!==i&&"dms"!==i)this._mode=3;else{if(this._mode=4,window.proj4||(window.proj4=h),this.proj4Wkid&&(t=this.proj4Wkid),!this.proj4Catalog&&!t&&!this.proj4CustomURL)return void n.publish("viewer/handleError",{source:"MapInfo",error:"MapInfo error::a proj4Catalog/proj4Wkid or custom URL must be defined"});var s=this.proj4Catalog+":"+String(t);if(this._projection=s,!h.defs[s]){var e=this.proj4CustomURL||this.proj4BaseURL+String(t)+".js";require([e],a.hitch(this,function(){this._projectionLoaded=!0}))}}this.minWidth&&d.set(this.domNode,"minWidth",this.minWidth+"px"),this.showScale&&(this._setScale(),o.on("zoom-end",a.hitch(this,"_setScale"))),this.showZoom&&(this._setZoom(),o.on("zoom-end",a.hitch(this,"_setZoom"))),o.on("mouse-move, mouse-drag",a.hitch(this,"_setCoords"))},_setCoords:function(o){var t=o.mapPoint,i=this.mode,s=this.unitScale;switch(this._mode){case 0:case 3:this._xCoord(r.round(t.x,s)),this._yCoord(r.round(t.y,s));break;case 1:"dms"===i?(this._xCoord(this._decToDMS(t.getLongitude(),"x")),this._yCoord(this._decToDMS(t.getLatitude(),"y"))):(this._xCoord(r.round(t.getLongitude(),s)),this._yCoord(r.round(t.getLatitude(),s)));break;case 2:"dms"===i?(this._xCoord(this._decToDMS(t.x,"x")),this._yCoord(this._decToDMS(t.y,"y"))):(this._xCoord(r.round(t.x,s)),this._yCoord(r.round(t.y,s)));break;case 4:this._projectionLoaded&&this._project(t)}},_project:function(o){var t=h(h.defs[this._projection]).inverse([o.x,o.y]);"dms"===this.mode?(this._xCoord(this._decToDMS(t[0],"x")),this._yCoord(this._decToDMS(t[1],"y"))):(this._xCoord(r.round(t[0],this.unitScale)),this._yCoord(r.round(t[1],this.unitScale)))},_setScale:function(){var o=this.map.getScale();null===o||isNaN(o)||i.set(this.scaleNode,String(r.format(r.round(o,0))))},_setZoom:function(){i.set(this.zoomNode,String(this.map.getLevel()))},_xCoord:function(o){i.set(this.xNode,String(o))},_yCoord:function(o){i.set(this.yNode,String(o))},_decToDMS:function(o,t){var i="?",s=Math.abs(o),e=parseInt(s,10),a=60*(s-e),d=parseInt(a,10),n=r.round(60*(a-d),this.unitScale);return"lat"!==t&&"y"!==t||(i=0<o?"N":"S"),"lng"!==t&&"x"!==t||(i=0<o?"E":"W"),e+"&deg;"+(d<10?"0"+d:d)+"'"+(n<10?"0"+n:n)+'"&nbsp;'+i}})});
//# sourceMappingURL=MapInfo.js.map