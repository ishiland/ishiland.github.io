/*  ConfigurableMapViewerCMV
 *  version 2.0.0-beta.2
 *  Project: https://cmv.io/
 */

define(["dojo/_base/declare","dijit/TitlePane","dojo/on","dojo/_base/lang","dojo/dnd/Moveable","dojo/aspect","dojo/topic","dojo/sniff","dojo/_base/window","dojo/window","dojo/dom-geometry","dojo/dom-style","dojo/dom-construct","dojo/dom-attr","dojo/dom-class","dojox/layout/ResizeHandle","xstyle/css!dojox/layout/resources/ResizeHandle.css","xstyle/css!./FloatingTitlePane/css/FloatingTitlePane.css"],function(i,t,e,s,o,n,a,h,r,d,l,c,g,u,_,p){return i([t],{sidebarPosition:null,canFloat:!1,isFloating:!1,isDragging:!1,dragDelay:3,resizable:!1,resizeOptions:{},isResizing:!1,postCreate:function(){this.canFloat&&(this.createDomNodes(),this.own(e(window,"resize",s.hitch(this,"_endDrag")))),this.iconClass&&(this.iconNode=g.create("span",{class:"titlePaneIcon "+this.iconClass},this.titleNode,"before")),this.own(a.subscribe("titlePane/event",s.hitch(this,"_updateWidgetSidebarPosition"))),this.own(n.after(this,"toggle",s.hitch(this,"_afterToggle"))),this.inherited(arguments)},startup:function(){this.titleBarNode&&this.canFloat&&(this._moveable=new o(this.domNode,{handle:this.titleBarNode,delay:this.dragDelay}),0<this.dragDelay&&(this._moveable.mover.prototype.onMouseUp=function(i){this.destroy(),i.preventDefault(),i.stopPropagation()}),this._titleBarHeight=c.get(this.titleBarNode,"height"),n.after(this._moveable,"onMove",s.hitch(this,"_dragging"),!0),n.after(this._moveable,"onMoveStop",s.hitch(this,"_endDrag"),!0),n.after(this._moveable,"onMoveStart",s.hitch(this,"_startDrag"),!0),e(document,"mouseup, touchend",s.hitch(this,"_endDrag"))),this.inherited(arguments)},createDomNodes:function(){if(this.moveHandleNode=g.create("span",{title:"Move widget",class:"floatingWidgetPopout"},this.titleNode,"after"),this.dockHandleNode=g.create("span",{title:"Dock widget",style:"display:none",class:"floatingWidgetDock"},this.titleNode,"after"),this.own(e(this.dockHandleNode,"click",s.hitch(this,function(i){this._dockWidget(),i.stopImmediatePropagation()}))),this.resizable){var i=s.mixin({targetId:this.id,activeResize:!0,intermediateChanges:!0,startTopic:this.id+"/resize/start",endTopic:this.id+"/resize/end"},this.resizeOptions);this._resizer=new p(i).placeAt(this.id),c.set(this._resizer.resizeHandle,"display","none"),e(this._resizer,"resize",s.hitch(this,"_resizing"),!0),this.own(a.subscribe(this.id+"/resize/start",s.hitch(this,"_startResize"))),this.own(a.subscribe(this.id+"/resize/end",s.hitch(this,"_endResize")))}},toggle:function(){this.isFloating&&this.isDragging||this.resizing||this.inherited(arguments)},_afterToggle:function(){var i=this.open?"open":"close";this._updateTopic(i)},_dragging:function(){if(this.isDragging=!0,this.titleCursor||(this.titleCursor=c.get(this.titleBarNode,"cursor")),c.set(this.titleBarNode,"cursor","move"),!this.isFloating){this._checkSidebarPosition(),c.set(this.dockHandleNode,"display","inline"),c.set(this.moveHandleNode,"display","none"),c.set(this.domNode,"z-index","40");var i=c.getComputedStyle(this.containerNode),t=parseInt(c.getComputedStyle(this.sidebar.containerNode).width,10);l.setContentSize(this.domNode,{w:t-2},i),this.isFloating=!0,this.placeAt(r.body()),c.set(this.domNode,{top:this._moverBox.t-this._titleBarHeight+"px"}),this.resizable&&this._resizer&&this._resizer.resizeHandle&&c.set(this._resizer.resizeHandle,"display","block"),this._updateTopic("undock")}},_startDrag:function(i){this._moverBox=i.marginBox},_endDrag:function(){var i=l.position(this.domNode),t=d.getBox(this.ownerDocument);i.y=Math.min(Math.max(i.y,0),t.h-i.h),i.x=Math.min(Math.max(i.x,0),t.w-i.w),this._relativePosition=i,this._position(),c.set(this.titleBarNode,"cursor",this.titleCursor),window.setTimeout(s.hitch(this,function(){this.isDragging=!1}),50)},_position:function(){if(!_.contains(this.ownerDocumentBody,"dojoMove")){var i=this.domNode,t=d.getBox(this.ownerDocument),e=this._relativePosition,s=e?null:l.position(i),o=Math.floor(t.l+(e?e.x:(t.w-s.w)/2)),n=Math.floor(t.t+(e?e.y:(t.h-s.h)/2));c.set(i,{left:o+"px",top:n+"px"})}},_dockWidget:function(){if(!this.isDragging){u.remove(this.domNode,"style"),c.set(this.dockHandleNode,"display","none"),c.set(this.moveHandleNode,"display","inline");var i=this.sidebar.getChildren();(this.sidebarPosition>i.length||this.sidebarPosition<0)&&(this.sidebarPosition=i.length),this.placeAt(this.sidebar,this.sidebarPosition),this.isFloating=!1,this._updateTopic("dock")}this.resizable&&this._resizer&&this._resizer.resizeHandle&&(c.set(this._resizer.resizeHandle,"display","none"),this._initialDimensions&&a.publish(this.id+"/resize/resize",this._initialDimensions))},_updateWidgetSidebarPosition:function(i){var t=i.widgetID,e=i.sidebarPosition,s=i.action;if(t!==this.id&&this.canFloat&&("dock"===s||"undock"===s))if(this._checkSidebarPosition(),"dock"===s){var o=this.sidebar.getChildren();e<this.sidebarPosition&&this.sidebarPosition<o.length&&this.sidebarPosition++}else"undock"===s&&e<this.sidebarPosition&&0<this.sidebarPosition&&this.sidebarPosition--},_checkSidebarPosition:function(){var i=this.sidebar.getChildren();if(null===this.sidebarPosition){var t=0,e=i.length;for(t=0;t<e;t++){var s=i[t];s.canFloat&&(s.sidebarPosition=t)}}},_resizing:function(i){this.isResizing=!0;var t=this._resizer._getNewCoords(i,this,"margin");t&&a.publish(this.id+"/resize/resize",{h:this._resizeDimensions.h+(t.h-this._resizer.startSize.h),w:this._resizeDimensions.w+(t.w-this._resizer.startSize.w)})},_startResize:function(){this.isResizing=!0,this._resizeDimensions=l.getContentBox(this.containerNode),this._initialDimensions||(this._initialDimensions=this._resizeDimensions)},_endResize:function(){this.isResizing=!1,c.set(this.domNode,"height","auto")},_updateTopic:function(i){a.publish("titlePane/event",{category:"Titlepane Event",action:i,label:this.title,widgetID:this.id,sidebarPosition:this.sidebarPosition,value:i})}})});
//# sourceMappingURL=FloatingTitlePane.js.map